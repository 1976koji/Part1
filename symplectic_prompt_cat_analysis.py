

# ---------- çŒ«ã‚³ãƒ¼ãƒ‘ã‚¹ ----------
# =========================================
# ðŸ± æ—¥æœ¬èªžçŒ«ã‚³ãƒ¼ãƒ‘ã‚¹ï¼ˆ100 æ–‡ï¼‰
# =========================================
cats_100 = [
    "ç§ã¯çŒ«ãŒå¥½ãã ã€‚",
    "é»’çŒ«ã®ã¤ã‚„ã‚„ã‹ãªæ¯›ä¸¦ã¿ã‚’è¦‹ã‚‹ã¨å¿ƒãŒè½ã¡ç€ãã€‚",
    "çŒ«ã®ã‚´ãƒ­ã‚´ãƒ­ã¨ã„ã†å–‰é³´ã‚‰ã—ã¯æœ€é«˜ã®ç™’ã‚„ã—ã ã€‚",
    "æœæ—¥ã‚’æµ´ã³ã¦ä¼¸ã³ã‚’ã™ã‚‹çŒ«ã®å§¿ãŒæ„›ãŠã—ã„ã€‚",
    "å­çŒ«ãŒæ®µãƒœãƒ¼ãƒ«ç®±ã®ä¸­ã§ä¸¸ã¾ã£ã¦çœ ã£ã¦ã„ã‚‹ã€‚",
    "ä¸‰æ¯›çŒ«ã®æ¨¡æ§˜ã¯ä¸–ç•Œã«äºŒã¤ã¨åŒã˜ã‚‚ã®ãŒãªã„ã€‚",
    "çŒ«ã¯å¥½å¥‡å¿ƒæ—ºç››ã§ã€ã™ãé«˜ã„æ‰€ã«ç™»ã‚ŠãŸãŒã‚‹ã€‚",
    "ç‹­ã„éš™é–“ã«å™¨ç”¨ã«å…¥ã‚Šè¾¼ã‚€ã®ã¯çŒ«ãªã‚‰ã§ã¯ã ã€‚",
    "è‚‰çƒã®ã·ã«ã·ã«ã—ãŸæ„Ÿè§¦ãŒãŸã¾ã‚‰ãªã„ã€‚",
    "é›¨ã®æ—¥ã€çª“è¾ºã§å¤–ã‚’çœºã‚ã‚‹çŒ«ã®æ¨ªé¡”ãŒè©©çš„ã ã€‚",
    "å¤œæ›´ã‘ã«é™ã‹ã«æ­©ãçŒ«ã®è¶³éŸ³ã¯ã»ã¨ã‚“ã©èžã“ãˆãªã„ã€‚",
    "çŒ«ã¯ç´™è¢‹ã‚’è¦‹ã‚‹ã¨å¿…ãšã¨è¨€ã£ã¦ã„ã„ã»ã©æ½œã‚Šè¾¼ã‚€ã€‚",
    "ç·‘è‰²ã®çž³ãŒãƒ©ãƒ³ãƒ—ã®ã‚ˆã†ã«æš—é—‡ã§å…‰ã‚‹ã€‚",
    "ã‚­ãƒ£ãƒƒãƒˆã‚¿ãƒ¯ãƒ¼ã®ã¦ã£ãºã‚“ã¯å½¼ã‚‰ã®ç‰¹ç­‰å¸­ã ã€‚",
    "çŒ«ã˜ã‚ƒã‚‰ã—ã‚’æŒ¯ã‚‹ã¨ç›®ã‚’è¼ã‹ã›ã¦é£›ã³ã¤ãã€‚",
    "æ¯›ã¥ãã‚ã„ã«ä½™å¿µãŒãªãã€å¸¸ã«èº«ã ã—ãªã¿ã¯å®Œç’§ã€‚",
    "é­šã®åŒ‚ã„ãŒã™ã‚‹ã¨å°æ‰€ã¸ä¸€ç›´ç·šã«èµ°ã£ã¦æ¥ã‚‹ã€‚",
    "ãƒ€ãƒ³ãƒœãƒ¼ãƒ«ã‚’å™›ã‚“ã§ãƒœãƒ­ãƒœãƒ­ã«ã™ã‚‹ã®ãŒæ—¥èª²ã€‚",
    "æ—¥å‘ã¼ã£ã“ã‚’ã—ã¦ã„ã‚‹å§¿ã¯ã¾ã‚‹ã§å½«åˆ»ã®ã‚ˆã†ã€‚",
    "å¤•æš®ã‚Œæ™‚ã€è·¯åœ°è£ã§çŒ«åŒå£«ãŒæŒ¨æ‹¶ã‚’äº¤ã‚ã—ã¦ã„ãŸã€‚",
    "é•·æ¯›ç¨®ã¯ãƒ–ãƒ©ãƒƒã‚·ãƒ³ã‚°ã™ã‚‹ã¨é›²ã®ã‚ˆã†ãªæ¯›ãŒèˆžã†ã€‚",
    "çŒ«ã‚«ãƒ•ã‚§ã§ã¯æ™‚é–“ãŒçµŒã¤ã®ã‚’å¿˜ã‚Œã¦ã—ã¾ã†ã€‚",
    "ã”é£¯ã®æ™‚é–“ã«ãªã‚‹ã¨éˆ´ã®ã‚ˆã†ãªå£°ã§é³´ã„ã¦å‚¬ä¿ƒã™ã‚‹ã€‚",
    "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚µã‚¤ãƒˆã§çŒ«ç”¨ãŠã‚„ã¤ã‚’å¤§é‡è³¼å…¥ã—ãŸã€‚",
    "çŒ«ã¯æ–°ã—ã„æ®µãƒœãƒ¼ãƒ«ç®±ã‚’è¦‹ã¤ã‘ã‚‹ã¨å³åº§ã«æ”¯é…ã™ã‚‹ã€‚",
    "ã‚¹ã‚³ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã®æŠ˜ã‚ŒãŸè€³ãŒã‚­ãƒ¥ãƒ¼ãƒˆã ã€‚",
    "ã‚«ãƒ¼ãƒ†ãƒ³ã«ã‚ˆã˜ç™»ã‚‰ã‚Œã¦ç©´ãŒé–‹ã„ãŸã€‚",
    "ã‚½ãƒ•ã‚¡ã®éš…ã§é¦™ç®±åº§ã‚Šã‚’ã—ã¦ã„ã‚‹ã€‚",
    "çŒ«ã¯äººé–“ã®è¨€è‘‰ã®æŠ‘æšã‚’ã‚ˆãèžãåˆ†ã‘ã‚‹ã¨ã„ã†ã€‚",
    "çŒ«è‰ã‚’é£Ÿã¹ã¦èƒƒã‚’æ•´ãˆã‚‹è³¢ã•ã«æ„Ÿå¿ƒã™ã‚‹ã€‚",
    "æ—©æœã€æž•å…ƒã§å°ã•ããƒ‹ãƒ£ãƒ¼ã¨é³´ãèµ·ã“ã—ã¦ãã‚Œã‚‹ã€‚",
    "ãŠè…¹ã‚’è¦‹ã›ã¦ã‚´ãƒ­ãƒ³ã¨è»¢ãŒã‚‹ã®ã¯ä¿¡é ¼ã®è¨¼ã€‚",
    "ã”ã¯ã‚“çš¿ã®éŸ³ã ã‘ã§é£›ã‚“ã§ãã‚‹è´è¦šã®é‹­ã•ã€‚",
    "çŒ«ç”¨ã®ãƒˆãƒ³ãƒãƒ«ãŠã‚‚ã¡ã‚ƒã§å»¶ã€…ã¨éŠã‚“ã§ã„ã‚‹ã€‚",
    "ã‚­ãƒ£ãƒƒãƒˆã‚¦ã‚©ãƒ¼ã‚¯ã‚’ä½œã£ãŸã‚‰éƒ¨å±‹ãŒç«‹ä½“çš„ã«ä½¿ã‚ã‚Œå§‹ã‚ãŸã€‚",
    "çŒ«ã®é³´ãå£°ã«ã¯18ç¨®é¡žä»¥ä¸Šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚",
    "ãƒ•ãƒªã‚¹ã‚­ãƒ¼ã‚’é–‹å°ã™ã‚‹ã¨è¢‹ã®éŸ³ã«æ•æ„Ÿã«åå¿œã€‚",
    "ã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼ã—ãŸç´™ç‰‡ã®ä¸Šã§ãµã¿ãµã¿ã‚’å§‹ã‚ãŸã€‚",
    "ã‚­ã‚¸ãƒˆãƒ©æŸ„ã¯æ£®ã®ã‚«ãƒ¢ãƒ•ãƒ©ãƒ¼ã‚¸ãƒ¥æ¨¡æ§˜ã ã€‚",
    "çŒ«ã®å°»å°¾ã¯æ„Ÿæƒ…ã®ãƒãƒ­ãƒ¡ãƒ¼ã‚¿ãƒ¼ã€‚",
    "çŽ„é–¢ã§å‡ºè¿Žãˆã‚‹ã¨ãã®å°èµ°ã‚ŠãŒå¯æ„›ã„ã€‚",
    "ã“ãŸã¤ã‹ã‚‰é¡”ã ã‘å‡ºã—ã¦å¯è½ã¡ã—ã¦ã„ã‚‹ã€‚",
    "èª­æ›¸ã‚’å§‹ã‚ã‚‹ã¨å¿…ãšæœ¬ã®ä¸Šã«åº§ã‚‹ã€‚",
    "é³¥ã®ã•ãˆãšã‚Šã«åå¿œã—ã¦ãƒ†ãƒ¬ãƒ“ã‚’ã‚¿ãƒƒãƒã™ã‚‹ã€‚",
    "æ¯›çŽ‰ã‚’åã„ãŸå¾Œã¯å°‘ã—ç”³ã—è¨³ãªã•ãã†ãªè¡¨æƒ…ã€‚",
    "ç ‚ã®ãƒˆã‚¤ãƒ¬ã‚’ä¸å¯§ã«æŽ˜ã£ã¦ã‹ã‚‰ç”¨ã‚’è¶³ã™ã€‚",
    "çª“ã‚¬ãƒ©ã‚¹ã«æ˜ ã‚‹è‡ªåˆ†ã®å§¿ã«ãƒ‘ãƒ³ãƒã‚’ç¹°ã‚Šå‡ºã™ã€‚",
    "ãŠã‚‚ã¡ã‚ƒã®ãƒ¬ãƒ¼ã‚¶ãƒ¼ãƒã‚¤ãƒ³ã‚¿ã‚’å…¨åŠ›ã§è¿½ã„ã‹ã‘ã‚‹ã€‚",
    "çŒ«èƒŒã¨è¨€ã†ãŒã€ä¸¸ã¾ã£ãŸèƒŒä¸­ã¯å„ªé›…ã§ã‚‚ã‚ã‚‹ã€‚",
    "ã­ãšã¿ã®ãŠã‚‚ã¡ã‚ƒã‚’ãã‚ãˆã¦æˆ¦åˆ©å“ã¨ã—ã¦æŒã£ã¦ãã‚‹ã€‚",
    "ç™½çŒ«ã¯æœˆå…‰ã‚’æµ´ã³ã‚‹ã¨å¹½çŽ„ãªé›°å›²æ°—ã‚’é†¸ã™ã€‚",
    "ã‚­ãƒƒãƒãƒ³ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã«ä¹—ã‚‰ãªã„ã§ã¨ä½•åº¦æ³¨æ„ã—ãŸã“ã¨ã‹ã€‚",
    "å¼•ãå‡ºã—ã‚’é–‹ã‘ã‚‹éŸ³ã§ãŠã‚„ã¤ã ã¨æ‚Ÿã‚‹ã€‚",
    "çŽ„é–¢ãƒžãƒƒãƒˆã®ä¸Šã§è…¹ã°ã„ã«ãªã£ã¦äººé–“ã‚’å¾…ã¤ã€‚",
    "ã™ã‚Šå¯„ã£ã¦ãã‚‹ã¨ãã®é ¬ã®æŸ”ã‚‰ã‹ã•ãŒå¥½ãã ã€‚",
    "çŒ«ãŒè†ã«ä¹—ã‚‹ã¨èº«å‹•ããŒã¨ã‚Œãªããªã‚‹ã€ŒçŒ«æ‹˜æŸã€ã€‚",
    "é«˜é€Ÿã§ã—ã£ã½ã‚’æŒ¯ã‚‹ã®ã¯ä¸æ©Ÿå«Œã®ã‚µã‚¤ãƒ³ã€‚",
    "é¦–è¼ªã®éˆ´ãŒãƒãƒªãƒ³ã¨é³´ã‚‹ãŸã³ã«æ‰€åœ¨ãŒã‚ã‹ã‚‹ã€‚",
    "å¤œä¸­ã«å¤§é‹å‹•ä¼šã‚’é–‹å‚¬ã—ã¦å®¶ãŒæºã‚Œã‚‹ã€‚",
    "ã‚­ãƒ£ãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é–‹ã‘ã‚‹ã¨ç›®ãŒçœŸå‰£ã«ãªã‚‹ã€‚",
    "å¸ƒå›£ã«æ½œã‚Šè¾¼ã‚“ã§è¶³ã‚’æ¸©ã‚ã¦ãã‚Œã‚‹ã€‚",
    "èžãæ…£ã‚Œãªã„æ¥å®¢ã®å£°ã«è­¦æˆ’ã—ã¦éš ã‚Œã‚‹ã€‚",
    "æ­¯ç£¨ãã‚¬ãƒ ã‚’å™›ã‚€å§¿ãŒæ„å¤–ã¨ãƒ¯ã‚¤ãƒ«ãƒ‰ã€‚",
    "ç£åŒ»ã•ã‚“ã®è¨ºå¯Ÿå°ã§ã¯å›ºã¾ã£ã¦çŸ³åƒã®ã‚ˆã†ã€‚",
    "ãƒˆãƒ¼ãƒˆãƒãƒƒã‚°ã‚’ç½®ãã¨ä¸­ã«å…¥ã‚Šæ—…æ”¯åº¦ã”ã£ã“ã€‚",
    "å¯è¨€ã§å°ã•ããƒ‹ãƒ£ãƒƒã¨é³´ãå¤œã‚‚ã‚ã‚‹ã€‚",
    "æœã®ã‚¹ãƒˆãƒ¬ãƒƒãƒã§èƒŒä¸­ã‚’åã‚‰ã™å§¿ãŒãƒ¨ã‚¬ã®é”äººã€‚",
    "ãµã‚ãµã‚ã®å°»å°¾ã§é¡”ã‚’æ’«ã§ã‚‰ã‚Œã¦ãã™ãã£ãŸã„ã€‚",
    "çŒ«ãŒã„ã‚‹ã ã‘ã§éƒ¨å±‹ã®ç©ºæ°—ãŒæŸ”ã‚‰ã‹ããªã‚‹ã€‚",
    "æ®µãƒœãƒ¼ãƒ«è¿·è·¯ã‚’ä½œã£ãŸã‚‰æŽ¢æ¤œéšŠé•·ã«ãªã£ãŸã€‚",
    "ã‚­ãƒ£ãƒƒãƒˆãƒ‹ãƒƒãƒ—å…¥ã‚Šã®ãŠã‚‚ã¡ã‚ƒã§é…”ã£ã±ã‚‰ã†æ§˜å­ãŒé¢ç™½ã„ã€‚",
    "èƒŒä¸­ã‚’ãƒˆãƒ³ãƒˆãƒ³ã™ã‚‹ã¨ãƒˆãƒ­ãƒ³ã¨ç›®ã‚’ç´°ã‚ã‚‹ã€‚",
    "çª“è¾ºã§è¶ã‚’ç›®ã§è¿½ã†ãƒãƒ³ã‚¿ãƒ¼ã®è¡¨æƒ…ã€‚",
    "éšŽæ®µã‚’ä¸€æ®µé£›ã°ã—ã§é§†ã‘ä¸ŠãŒã‚‹è·³èºåŠ›ã€‚",
    "ã‚¹ãƒžãƒ›ã®ç”»é¢ã‚’çŒ«ç”¨ã‚²ãƒ¼ãƒ ã«ã™ã‚‹ã¨çœŸå‰£ãã®ã‚‚ã®ã€‚",
    "ã‚³ãƒ¼ãƒ’ãƒ¼è±†ã®åŒ‚ã„ã«ã¯èˆˆå‘³ã‚’ç¤ºã•ãªã„ã€‚",
    "ã‚¯ãƒªã‚¹ãƒžã‚¹ãƒ„ãƒªãƒ¼ã‚’ã‚ˆã˜ç™»ã‚Šé£¾ã‚Šã‚’è½ã¨ã™äº‹ä»¶ã€‚",
    "é›·ãŒé³´ã‚‹ã¨ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆã®å¥¥ã¸é¿é›£ã€‚",
    "ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼å¾Œã®ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ ã¯å¤§é¨’ãŽã€‚",
    "çª“ã®çµéœ²ã‚’èˆã‚ã¦æ€’ã‚‰ã‚Œã‚‹ã€‚",
    "é•·ã„ã²ã’ã¯å¤œé–“ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è£…ç½®ã€‚",
    "ã”ã‚ã‚“ã¨æ¨ªã«ãªã‚ŠãŠè…¹ã‚’æ’«ã§ã¦ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚",
    "çŒ«è¦æ ¼ã®å¹…ã®ç´°ã„æ£šã‚’æ­©ããƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã€‚",
    "æ–°ã—ã„åŒ‚ã„ã®æœã‚’ã‚¯ãƒ³ã‚¯ãƒ³ã¨ãƒã‚§ãƒƒã‚¯ã€‚",
    "ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã®ãƒšãƒ³å…ˆã‚’ç‹™ã£ã¦ç‹©ã‚Šã‚’ã™ã‚‹ã€‚",
    "æ´—æ¿¯ãƒãƒƒãƒˆã‚’è¦‹ã‚‹ã¨ç—…é™¢ã‚’é€£æƒ³ã—ã¦é€ƒã’è…°ã€‚",
    "å‹é”ã®çŠ¬ã¨ã¯é©åº¦ãªè·é›¢æ„Ÿã‚’ä¿ã¤ã€‚",
    "éµã®ã‚¸ãƒ£ãƒ©ã‚¸ãƒ£ãƒ©éŸ³ã«åå¿œã—ã¦çŽ„é–¢ã¸ã€‚",
    "çŒ«ç”¨ãƒ–ãƒ©ã‚·ã‚’è¦‹ã‚‹ã¨å–œã‚“ã§é ­ã‚’æŠ¼ã—ä»˜ã‘ã‚‹ã€‚",
    "çŒ«ã¯å®¶ã«ã¤ãã¨è¨€ã†ãŒã€äººã«ã‚‚ã¡ã‚ƒã‚“ã¨æ‡ãã€‚",
    "ç®¸ç½®ãã‚’è»¢ãŒã—ã¦ã‚µãƒƒã‚«ãƒ¼ã‚’å§‹ã‚ã‚‹ã€‚",
    "é›»æ°—ã‚¹ãƒˆãƒ¼ãƒ–ã®å‰ã‚’ç‹¬å ã—ã¦å‹•ã‹ãªã„ã€‚",
    "é³´ãå£°ã§æ™‚åˆ»ã‚’çŸ¥ã‚‰ã›ã‚‹æ­£ç¢ºãªè…¹æ™‚è¨ˆã€‚",
    "ã‚µãƒ³ã‚°ãƒ©ã‚¹ã‚’ã‹ã‘ãŸå†™çœŸãŒ SNS ã§ãƒã‚ºã£ãŸã€‚",
    "ãƒ„ãƒ³ãƒ‡ãƒ¬ãªæ…‹åº¦ã‚‚é­…åŠ›ã®ä¸€éƒ¨ã ã€‚",
    "éŒ²ç”»ã—ãŸé³¥å‹•ç”»ã‚’ãƒ†ãƒ¬ãƒ“ã«æ˜ ã™ã¨å¤§èˆˆå¥®ã€‚",
    "ã‚­ãƒ£ãƒªãƒ¼ã‚±ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨æ—…è¡Œã‹ç—…é™¢ã‹ã§è¡¨æƒ…ãŒå¤‰ã‚ã‚‹ã€‚",
    "äººé–“ã®ãã—ã‚ƒã¿ã«é©šã„ã¦å°»å°¾ãŒè†¨ã‚‰ã‚€ã€‚",
    "ãŠã‚„ã¤ã®è¢‹ã‚’éš ã™å ´æ‰€ã‚’ã™ã§ã«å­¦ç¿’ã—ã¦ã„ã‚‹ã€‚",
    "ä»Šæ—¥ã‚‚ã€Œç§ã¯çŒ«ãŒå¥½ãã ã€ã¨å†ç¢ºèªã—ãŸã€‚"
]         # â† å…ˆã»ã©ã® 100 æ–‡ã‚³ãƒ¼ãƒ‘ã‚¹


# ===========================================
#  å‹•çš„ãƒšã‚¢æŠ½å‡º + ãƒšã‚¢åˆ¥ IÎ¾ è©•ä¾¡ ç‰ˆ
# ===========================================
import os, statistics, tqdm, openai, numpy as np
from janome.tokenizer import Tokenizer

# ---------------- 0) OpenAI è¨­å®š ----------------
#openai.api_key = os.getenv("OPENAI_API_KEY", "XXX")  # â†è¦å¤‰æ›´
MODEL_GEN   = "gpt-4o-mini"
MODEL_EMBED = "text-embedding-3-large"
MAX_TOK     = 50
TOP_P       = 0.95

# ---------------- 1) ã‚³ãƒ¼ãƒ‘ã‚¹ -------------------
#from cats_corpus import cats_100   # 100 æ–‡

# ---------------- 2) å‹•çš„ãƒšã‚¢æŠ½å‡º ---------------
PAIR_DICT = {
    "çŒ«": "å­çŒ«",
    "è‚‰çƒ": "è¶³è£",
    "é»’çŒ«": "é»’ã„çŒ«",
    "ä¸‰æ¯›çŒ«": "ä¸‰æ¯›",
}
tokenizer = Tokenizer(wakati=True)

def extract_pairs(seed: str):
    nouns = set(tokenizer.tokenize(seed))
    pairs = []
    for w in nouns:
        if w in PAIR_DICT:
            pairs.append((w, PAIR_DICT[w]))
        elif w in PAIR_DICT.values():
            k = [k for k, v in PAIR_DICT.items() if v == w][0]
            pairs.append((k, w))
    return pairs                       # list[(a,b)]

# ---------------- 3) åŸ‹ã‚è¾¼ã¿ with ã‚­ãƒ£ãƒƒã‚·ãƒ¥ -----
_emb_cache = {}
def embed(text: str):
    if text not in _emb_cache:
        vec = openai.embeddings.create(model=MODEL_EMBED,
                                       input=text).data[0].embedding
        _emb_cache[text] = np.asarray(vec, dtype=np.float32)
    return _emb_cache[text]

# ---------------- 4) ä¿å­˜é‡ IÎ¾ -------------------
def I_xi(q, p, pairs):
    """è¤‡æ•°ãƒšã‚¢ãŒã‚ã‚Œã°å¹³å‡ã‚’è¿”ã™"""
    vals = []
    for a, b in pairs:
        e_a, e_b = embed(a), embed(b)
        A = np.outer(e_b, e_a) - np.outer(e_a, e_b)
        vals.append(float(p @ (A @ q)))
    return float(np.mean(vals)) if vals else None

# ---------------- 5) Symp-prompt ---------------
def build_symp_prompt(seed: str, pairs):
    if pairs:
        joined = "ã€".join(f"{a}â‡„{b}" for a, b in pairs)
        pair_part = f"ï¼ˆä¾‹ï¼š{joined}ï¼‰"
    else:
        pair_part = "ï¼ˆæœ¬è¡Œã«ã¯ãƒšã‚¢ãªã—ï¼‰"
    return (
        f"{seed}\n"
        "ä»¥ä¸‹ã®æ–‡è„ˆã§ç”¨ã„ã‚‰ã‚ŒãŸå›ºæœ‰èªžãƒ»åŒç¾©èªžãƒšã‚¢ã‚’ä¿æŒã—ã€"
        "æ–‡ä½“ãƒ»ãƒªã‚ºãƒ ã‚’å¤‰ãˆãšã«ç¶šãã‚’ 50 token ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n"
        f"åˆ¶ç´„ï¼šå‡ºç¾æ¸ˆã¿ã®èªž {pair_part} ã¯ "
        "åŒä¸€è¡¨ç¾ã¾ãŸã¯å¯¾å¿œãƒšã‚¢ã®ã¿è¨±å¯ã—ã€ä»–ã®ç½®æ›èªžã¯å°Žå…¥ã—ãªã„ã€‚"
    )

def generate(seed, T, symp=False):
    prompt = (build_symp_prompt(seed, extract_pairs(seed))
              if symp else f"{seed}\nç¶šãã® 50 token ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚")
    resp = openai.chat.completions.create(
        model     = MODEL_GEN,
        messages  = [{"role":"user","content": prompt}],
        max_tokens  = MAX_TOK,
        temperature = T,
        top_p       = TOP_P,
    )
    return resp.choices[0].message.content

# ---------------- 6) è©•ä¾¡ãƒ«ãƒ¼ãƒ— -----------------
def run_series(name, T, symp=False):
    drifts, Ivals = [], []
    for seed in tqdm.tqdm(cats_100, desc=f"{name}@T={T}"):
        gen   = generate(seed, T, symp)
        q, p  = embed(seed), embed(gen)
        drifts.append(np.linalg.norm(q - p))
        I_val = I_xi(q, p, extract_pairs(seed))
        if I_val is not None:
            Ivals.append(I_val)
    mean_drift = statistics.mean(drifts)
    var_I      = statistics.variance(Ivals) if len(Ivals) > 1 else float("nan")
    print(f"{name}: D_drift={mean_drift:.6f} , Var(I_xi)={var_I:.6e}  "
          f"({len(Ivals)}/{len(drifts)} seeds)")
    return mean_drift, var_I

# ---------------- 7) å®Ÿè¡Œ -----------------------
if __name__ == "__main__":
    results = {}
    for T in (1.0, 0.7):
        results[("plain", T)] = run_series("plain", T, symp=False)
    results[("symp_dyn", 0.7)] = run_series("symp_dyn", 0.7, symp=True)

    print("\n=== summary ===")
    for k, (d, v) in results.items():
        print(f"{k}: drift={d:.6f}  var={v:.6e}")
